<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>MediaDevices</title>
  </head>
  <body>
    <input id="recordBtn" type="button" value="Record" />
    <input id="stopBtn" type="button" value="Stop and play" />
    <audio id="recordAudio" autoplay="true"></audio>

    <script src="../../scripts/recorder.js" type="text/javascript"></script>
    <script type="text/javascript">
      // 纯html5 api
      (function(window){
        window.URL = window.URL || window.webkitURL;
        navigator.getUserMedia  = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
        var recordBtn = document.querySelector('#recordBtn');
        var stopBtn = document.querySelector('#stopBtn');
        var audio = document.querySelector('#recordAudio');
        var audioRecorder = null;

        recordBtn.addEventListener('click', function(){
          navigator.mediaDevices.getUserMedia({audio: true})
          .then(function(mediaStream){
            var context = new AudioContext();
            var mediaStreamSource = context.createMediaStreamSource(mediaStream);   // 媒体流音频源
            audioRecorder = new Recorder(mediaStreamSource);
            audioRecorder.recorder();
          }).catch(function(err){
            console.error(err);
          });
        });
        stopBtn.addEventListener('click', function(){
          audioRecorder.stop();
          audioRecorder.exportWAV(function(stream){
            audio.src = window.URL.createObjectURL(stream);
          });
        });
      })(window);
    </script>
  </body>
</html>
