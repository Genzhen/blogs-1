<html>
<title>test html to pdf</title>
<style>
  canvas{
    border: 1px solid #aaa;
  }
</style>
<body>
  <div id="content" style="width:910px;background: #fff;margin: 0 auto;">
    <div style="width:910px;height:100%;margin:2px auto;max-width: 920px;background: #fff;">
      <img src="../images/buffer.jpg" />
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <img style="max-width:900px;" src="https://gw.alipayobjects.com/zos/rmsportal/nGINITHcnyBpWWoDdRJT.jpg" alt="">

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>

      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>


      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
      <p>哈哈, zheshi fdjskaldjlk，tests</p>
    </div>
  </div>

  <script src="../scripts/rasterizeHTML.js"></script>
  <script src="https://gw.alipayobjects.com/os/rmsportal/wHkUbtUFDqSHbTrjkHoO.js"></script>
  <script>
  window.onload = function() {
    var canvas = document.createElement('canvas');
    var content = document.getElementById('content');
    var cloneContent = $(document.getElementById('content')).clone();
    cloneContent.find('div.edui-upload-video').remove();
    cloneContent.find('img').css('maxWidth', '100%');
    canvas.width = content.scrollWidth + 16;
    canvas.height = content.scrollHeight * 1.25;   // 字体和样式差异，拉高避免遗漏
    rasterizeHTML.drawHTML(cloneContent.html(), canvas).then(function (result) {
      var contentWidth = canvas.width;
      var contentHeight = result.image.height || canvas.height;

      // a4纸的尺寸[595.28,841.89]
      var a4Width = 595.28;
      var a4Height = 841.89;
      var pageHeight = contentWidth / a4Width * a4Height; // 一页pdf的高度
      //未生成pdf的html页面高度
      var copyContentHeight = contentHeight + 32;
      var position = 0;
      // html页面生成的canvas在pdf中图片的宽高
      var imgWidth = a4Width;
      var imgHeight = a4Width / contentWidth * contentHeight;
      var pageData = canvas.toDataURL('image/png');
      var pdf = new jsPDF('', 'pt', 'a4');  // 单位为pt

      // 当内容未超过pdf一页显示的范围，无需分页
      if (copyContentHeight < pageHeight) {
        pdf.addImage(pageData, 'png', 0, 0, imgWidth, imgHeight);
      } else {
        while (copyContentHeight > 0) {
          pdf.addImage(pageData, 'png', 0, position, imgWidth, imgHeight);
          copyContentHeight -= pageHeight;
          position -= a4Height;
          // 避免添加空白页
          if (copyContentHeight > 0) {
            pdf.addPage();
          }
        }
      }
      pdf.save(articleName + '.pdf');
      downloading = false;
      // document.body.appendChild(canvas);
      // document.body.appendChild(result.image);
    });
      
  }
  </script>
</body>

</html>