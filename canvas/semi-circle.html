<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="wap-font-scale" content="no">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>
        <title>swipe page</title>
        <link rel="stylesheet" href="../../stylesheets/reset.css" media="screen" title="no title" charset="utf-8">
        <style media="screen">
            html, body{
                height:100%;
                font-size: 16px;
                background-color:#39B3C4;
                font-family: "微软雅黑", "Microsoft Yahei", "黑体", sans-serif;
                background: url('https://os.alipayobjects.com/rmsportal/lUwNYKjbMApzJSG.png') no-repeat;
                background-size: cover;
                position: relative;
            }
            .result-container{
                height: 50%;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <div class="result-container">47|after|100</div>
        <script src="../libs/zepto.min.js"></script>
        <script type="text/javascript">
        $(function(){
            $.fn.annular = function(){
                var me = $(this),
                    w = me.width(),
                    h = me.height(),
                    text = me.text();
                $(this).append('<canvas class="annular" width="' + w + '" height="' + h / 2 + '">'+text+'</canvas');
                $('.annular', $(this)).each(function(){
                    var canvas = this,
                        w = canvas.width,
                        h = canvas.height,
                        ctx = canvas.getContext('2d'),
                        text = $(this).text(),
                        tempArr = text.split('|'),
                        num = tempArr[0] - 0,
                        status = tempArr[1],
                        content = '',
                        numText = '',
                        rate = 0,
                        color = '#0098FF';

                    if(num === undefined || status === undefined) return;
                    if(status === 'after'){
                        content = num >= 60 ? '分通过' : '分不通过';
                        color = num >= 60 ? '#0099FF' : '#FF9900';
                        numText = num + '';
                        rate = num / tempArr[2];
                    }else if(status === 'before'){
                        content = '进度';
                        numText = num + '/' + tempArr[2];
                    }

                    //画底色圆形
                    ctx.clearRect(0, 0, w, h);
                    ctx.beginPath();
                    ctx.fillStyle = "#379176";
                    ctx.moveTo(w / 2, h / 2);
                    ctx.arc(w / 2, h / 2, w / 2 - 1, Math.PI * 0.75, Math.PI * 0.25, false);
                    ctx.fill();
                    ctx.closePath();

                    //画进度圆形
                    ctx.beginPath();
                    ctx.fillStyle = color;
                    ctx.moveTo(w / 2, h / 2);
                    ctx.arc(w / 2, h / 2, w / 2 - 1, Math.PI * 0.75, 0, false);
                    ctx.fill();
                    ctx.closePath();

                    //画白色圆形，构造底色环形
                    ctx.beginPath();
                    ctx.fillStyle = "#fff";
                    ctx.moveTo(w / 2, h / 2);
                    ctx.arc(w / 2, h / 2, w / 2 * 0.9, Math.PI * 0.74, Math.PI * 0.26, false);
                    ctx.fill();
                    ctx.closePath();

                    ctx.beginPath();
                    var size = 14;
                    ctx.font = size + "px YaHei";
                    ctx.fillStyle = "#A6A19D";
                    var numTextPro = ctx.measureText(numText),
                        contentPro = ctx.measureText(content);

                    ctx.fillText(numText, w / 2 - numTextPro.width / 2, h / 2 - size / 2);
                    ctx.fillText(content, w / 2 - contentPro.width / 2, h / 2 + size);
                    ctx.closePath();
                });
            };

            $('.result-container').annular();
        });
        </script>
    </body>
</html>
