<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>annular</title>
        <style media="screen">
            html, body{height: 100%;font-size: 20px;}
        </style>
    </head>
    <body>
        <div class="annular-container">
            <canvas class="annular" width="280" height="280">9|after|120</canvas>
        </div>
        <script src="../libs/zepto.min.js"></script>
        <script type="text/javascript">
        $(function(){
            $.fn.annular = function(){
                $(this).each(function(){
                    var canvas = this,
                        w = canvas.width,
                        h = canvas.height,
                        ctx = canvas.getContext('2d'),
                        text = $(this).text(),
                        tempArr = text.split('|'),
                        num = tempArr[0] - 0,
                        status = tempArr[1],
                        content = '',
                        numText = '',
                        rate = 0,
                        color = '#0098FF';

                    if(num === undefined || status === undefined) return;
                    if(status === 'after'){
                        content = num >= 60 ? '分通过' : '分不通过';
                        color = num >= 60 ? '#0099FF' : '#FF9900';
                        numText = num + '';
                        rate = num / tempArr[2];
                    }else if(status === 'before'){
                        content = '进度';
                        numText = num + '/' + tempArr[2];
                    }

                    //画底色圆形
                    ctx.clearRect(0, 0, w, h);
                    ctx.beginPath();
                    ctx.fillStyle = "#999999";
                    ctx.moveTo(w / 2, h / 2);
                    ctx.arc(w / 2, h / 2, w / 2 - 1, Math.PI * 0.75, Math.PI * 0.25, true);
                    ctx.fill();
                    ctx.closePath();

                    //画进度圆形
                    ctx.beginPath();
                    ctx.fillStyle = color;
                    ctx.moveTo(w / 2, h / 2);
                    ctx.arc(w / 2, h / 2, w / 2 - 1, Math.PI * 0.75, 0, true);
                    ctx.fill();
                    ctx.closePath();

                    //画白色圆形，构造底色环形
                    ctx.beginPath();
                    ctx.fillStyle = "#fff";
                    ctx.moveTo(w / 2, h / 2);
                    ctx.arc(w / 2, h / 2, w / 2 * 0.8, Math.PI * 0.75, Math.PI * 0.25, true);
                    ctx.fill();
                    ctx.closePath();

                    ctx.beginPath();
                    var size = 14;
                    ctx.font = size + "px YaHei";
                    ctx.fillStyle = "#A6A19D";
                    var numTextPro = ctx.measureText(numText),
                        contentPro = ctx.measureText(content);

                    ctx.fillText(numText, w / 2 - numTextPro.width / 2, h / 2 - size / 2);
                    ctx.fillText(content, w / 2 - contentPro.width / 2, h / 2 + size);
                    ctx.closePath();
                });
            };

            $('.annular').annular();
        });
        </script>
    </body>
</html>
