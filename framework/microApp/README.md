## MicroAPP

### 微前端作用

* 多人协作

* 系统解耦，独立开发部署

* 沙箱隔离，无关技术栈

负面影响：通信成本、应用管理成本

### 原理

* 什么时候加载子应用？

  每个子应用分配一个基准路由 - /baseRoute，跳到对应基准路由加载对应子应用资源

* 如何捕捉基准路由变化？

  劫持 history.pushState 和 history.replaceState 两个 API，同时监听 popstate 事件，保证能够捕获到到所有路由变化。当捕获到路由变化时，根据路由查找对应的子应用，如果是新子应用则卸载当前子应用，同时加载新子应用并渲染。

* 如何将子应用的 bundle 渲染到指定节点？

  基座框架提给API 保证子应用能够渲染到指定的节点

* 刷新页面如何加载子应用？

  子应用资源都是懒加载的，重刷页面底座资源加载，同时底座的路由激活，但子应用的资源还没有完成加载，这时可能导致404或路由报错。因此，需要劫持 url change 事件实现自己的路由系统，预先加载子应用的资源，然后接管路由系统，退出此子应用，也可以用调用自己的方法卸载子应用。
  `destroy = () => ReactDOM.unmountAtNode(container)`

* 

### 沙箱隔离

* iframe

* 约定规范：不要污染全局变量、定时器及时清除、CSS 样式尽量通过前缀或者 CSS Modules 做隔离

* Shadow DOM 和 Web Worker


### 流行框架

* single-spa 知名度高，生态完善，对子应用有一点侵入性

* qiankun 基于上者的封装

* icestark 轻量简单，API简单直观