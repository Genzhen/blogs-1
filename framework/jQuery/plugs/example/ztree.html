<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ztree</title>
    <link rel="stylesheet" href="https://cdn.cdnjs.net/zTree.v3/3.5.29/css/zTreeStyle/zTreeStyle.css">
    <style media="screen">
      .ztree li{line-height: 18px;padding: 2px;}
      #rMenu {
        position: absolute;
        background-color: #F0F0F0;
        border: solid #ddd 1px;
      }
      #rMenu ul {
        padding: 0;
        margin: 8px 0;
      }
      #rMenu li {
        padding: 4px 24px;
        line-height: 22px;
        cursor: pointer;
        color: #333;
        list-style: none;
      }
      #rMenu li:hover {
        background-color: #7b68ee;
        color: #fff;
      }
    </style>
  </head>
  <body>
    <ul id="treeDemo" class="ztree"></ul>

    <div id="rMenu" style="display: none;">
      <ul>
        <li id="m_add">新增节点</li>
        <li id="m_edit">编辑节点</li>
        <li id="m_del">删除节点</li>
        <li id="m_refresh">刷新</li>
      </ul>
    </div>
    <script src="https://apps.bdimg.com/libs/jquery/1.9.1/jquery.js" type="text/javascript"></script>
    <script src="https://cdn.cdnjs.net/zTree.v3/3.5.29/js/jquery.ztree.all.js"></script>
    <script type="text/javascript">
      $(function () {
        var transformTreeData = function(data) {
          if (!Array.isArray(data)) return data;
          data.map(function(ele) {
            ele.isParent = !ele.leaf;
            ele.open = ele.root ? true : false;
            return ele;
          });
          return data;
        };

        jQuery.getJSON('./../mock/categorys.json', function(res){
          var setting = {
            async: {
              enable: true,
              type: 'get',
              url: './../mock/categorys2.json',
              dataFilter: function(id, pnode, res) { // 数据预处理
                return transformTreeData(res.data);
              }
            },
            data: {
              simpleData: {   // 同一级list结构，非嵌套的树形结构
                enable: true,
                idKey: 'id',
                pIdKey: 'fatherId',
                rootPid: 0
              }
            },
            callback: {
              onClick: function(e, id, node) {
                console.log('click ====== node: ', node);
              },
              beforeDrop: function(id, nodes, target, type) { // 禁止跨父节点拖拽

              },
              onRightClick: function(e, id, node) {   // 右键菜单
                $('#rMenu').css({top: e.pageY + 'px', left: e.pageX + 'px'}).show();
              }
            },
            edit: {
              drag: {
                autoExpandTrigger: true,
                prev: function(id, nodes, targetNode) {
                  console.log(nodes[0].pId, targetNode.pId);
                  return nodes[0].pId === targetNode.pId;
                },
                next: function (id, nodes, targetNode) {
                  console.log(nodes[0].pId, targetNode.pId);
                  return nodes[0].pId === targetNode.pId;
                },
                inner: false,
              },
              enable: true,
              showRemoveBtn: false,
              showRenameBtn: false
            }
          };

          jQuery.fn.zTree.init($('#treeDemo'), setting, transformTreeData(res.data));
        });

        $(document).on('click', function(){
          $('#rMenu').hide();
        });
      });
    </script>
  </body>

</html>