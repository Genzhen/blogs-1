<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Get rect point</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    .content{
      width: 1200px;
      min-height: 1800px;
      margin: 0 auto;
      background-image: url('./images/background.png');
      background-size: cover;
    }
    .content img {
      width: 1200px;
    }
    .linkRect{
      display: inline-block;
      position: absolute;
      cursor: pointer;
      z-index: 9;
      border: 1px solid #fff;
    }

    /* Moema */
    .button--moema {
      padding: 1.5em 3em;
      border-radius: 50px;
      background: #7986cb;
      color: #fff;
      -webkit-transition: background-color 0.3s, color 0.3s;
      transition: background-color 0.3s, color 0.3s;
    }
    .button--moema.button--inverted {
      background: #ECEFF1;
      color: #37474f;
    }
    .button--moema::before {
      content: '';
      position: absolute;
      top: -20px;
      left: -20px;
      bottom: -20px;
      right: -20px;
      background: inherit;
      border-radius: 50px;
      z-index: -1;
      opacity: 0.4;
      -webkit-transform: scale3d(0.8, 0.5, 1);
      transform: scale3d(0.8, 0.5, 1);
    }
    .button--moema:hover {
      -webkit-transition: background-color 0.1s 0.3s, color 0.1s 0.3s;
      transition: background-color 0.1s 0.3s, color 0.1s 0.3s;
      color: #ECEFF1;
      background-color: #3f51b5;
      -webkit-animation: anim-moema-1 0.3s forwards;
      animation: anim-moema-1 0.3s forwards;
    }
    .button--moema.button--inverted:hover {
      color: #ECEFF1;
      background-color: #7986cb;
    }
    .button--moema:hover::before {
      -webkit-animation: anim-moema-2 0.3s 0.3s forwards;
      animation: anim-moema-2 0.3s 0.3s forwards;
    }
    @-webkit-keyframes anim-moema-1 {
      60% {
        -webkit-transform: scale3d(0.8, 0.8, 1);
        transform: scale3d(0.8, 0.8, 1);
      }
      85% {
        -webkit-transform: scale3d(1.1, 1.1, 1);
        transform: scale3d(1.1, 1.1, 1);
      }
      100% {
        -webkit-transform: scale3d(1, 1, 1);
        transform: scale3d(1, 1, 1);
      }
    }
    @keyframes anim-moema-1 {
      60% {
        -webkit-transform: scale3d(0.8, 0.8, 1);
        transform: scale3d(0.8, 0.8, 1);
      }
      85% {
        -webkit-transform: scale3d(1.1, 1.1, 1);
        transform: scale3d(1.1, 1.1, 1);
      }
      100% {
        -webkit-transform: scale3d(1, 1, 1);
        transform: scale3d(1, 1, 1);
      }
    }
    @-webkit-keyframes anim-moema-2 {
      to {
        opacity: 0;
        -webkit-transform: scale3d(1, 1, 1);
        transform: scale3d(1, 1, 1);
      }
    }
    @keyframes anim-moema-2 {
      to {
        opacity: 0;
        -webkit-transform: scale3d(1, 1, 1);
        transform: scale3d(1, 1, 1);
      }
    }
  </style>
</head>
<body>
  <div class="content">
    <img src="./images/background.png" alt="background-image" />
  </div>
  <!-- coordinate -->
  <script>
    (function() { 
      var hasRectSelect = false, selRect, startX, startY, _x, _y;
      var content = document.querySelector('.content');

      var renderRect = function(o) {
        var link = document.createElement('a');
        link.style.cssText = `width: ${o.w}px;height: ${o.h}px;left: ${o.x}px; top: ${o.y}px;`;
        link.className = "linkRect";
        link.href = 'https://www.google.com/' + document.querySelectorAll('.linkRect').length;
        link.target = 'blank';
        document.body.appendChild(link);
      };

      document.querySelector('.content img').onload = function(){
        content.style.height = this.height + 'px';
        content.removeChild(this);
      };

      document.onmousedown = function(e) { 
        hasRectSelect = true;
        startX = e.pageX;
        startY = e.pageY;
        e.stopPropagation(); 
      };

      document.onmousemove = function(e) { 
        if (hasRectSelect) { 
          _x = e.pageX; 
          _y = e.pageY;
          var w = Math.abs(_x - startX);
          var h = Math.abs(_y - startY);

          if (w < 3 || h < 3) return;   // 优化性能，避免鼠标误点
          
          if (!selRect) {
            selRect = document.createElement("div"); 
            selRect.style.cssText = "position:absolute;width:0px;height:0px;font-size:0px;margin:0px;padding:0px;border:1px dashed #0099FF;background-color:#C3D5ED;z-index:1000;filter:alpha(opacity:60);opacity:0.6;";  
            document.body.appendChild(selRect);
          }

          selRect.style.left = Math.min(_x, startX) + "px";
          selRect.style.top = Math.min(_y, startY) + "px";
          selRect.style.width = w + "px";
          selRect.style.height = h + "px"; 
        } 
        e.stopPropagation(); 
      };

      document.onmouseup = function() { 
        hasRectSelect = false; 
        if (selRect) { 
          var s = selRect.style;
          var info = {
            x: parseInt(s.left),
            y: parseInt(s.top),
            w: parseInt(s.width),
            h: parseInt(s.height)
          };
          console.log(`coordinate: ${info.x}, ${info.y}, width: ${info.w}, height: ${info.h}`);
          renderRect(info);
          document.body.removeChild(selRect);
        } 
        _x = null, _y = null, selRect = null, startX = null, startY = null; 
      };
   })(); 
  </script>
</body>
</html>