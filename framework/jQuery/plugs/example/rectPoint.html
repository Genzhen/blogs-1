<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Get rect point</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    .content{
      width: 1200px;
      min-height: 1800px;
      margin: 0 auto;
      background-image: url('./images/background.png');
      background-size: cover;
    }
    .content img {
      width: 1200px;
    }
    .linkRect{
      display: inline-block;
      position: absolute;
      cursor: pointer;
      z-index: 9;
      border: 1px dashed #fff;
      text-decoration: none;
      padding: 3px;
    }
    .linkRect .resize {
      display: inline-block;
      position: absolute;
      height: 6px;
      width: 6px;
      right: -3px;
      bottom: -3px;
      cursor: nwse-resize;
      background-color: #3C9DD0;
    }
    .hotLinks {
      position: absolute;
      top: 0;
    }

    /* Moema */
    .button-moema {
      border-radius: 4px;
      color: #fff;
    }
    .button-moema::before {
      content: '';
      position: absolute;
      top: -20px;
      left: -20px;
      bottom: -20px;
      right: -20px;
      background: inherit;
      border-radius: 50px;
      z-index: -1;
      opacity: 0.4;
      -webkit-transform: scale3d(0.8, 0.5, 1);
      transform: scale3d(0.8, 0.5, 1);
    }
    .button-moema:hover {
      color: #e95924;
      border: 1px dashed #e95924;
      -webkit-animation: anim-moema-1 0.5s ease-in-out;
      animation: anim-moema-1 0.5s ease-in-out;
    }
    .button-moema:hover::before {
      -webkit-animation: anim-moema-2 0.5s 0.3s ease-in-out;
      animation: anim-moema-2 0.5s 0.3s ease-in-out;
    }
    @keyframes anim-moema-1 {
      60% {
        -webkit-transform: scale3d(0.8, 0.8, 1);
        transform: scale3d(0.8, 0.8, 1);
      }
      85% {
        -webkit-transform: scale3d(1.1, 1.1, 1);
        transform: scale3d(1.1, 1.1, 1);
      }
      100% {
        -webkit-transform: scale3d(1, 1, 1);
        transform: scale3d(1, 1, 1);
      }
    }
    @keyframes anim-moema-2 {
      to {
        opacity: 0;
        -webkit-transform: scale3d(1, 1, 1);
        transform: scale3d(1, 1, 1);
      }
    }
  </style>
</head>
<body>
  <!-- 背景图 -->
  <div class="content">
    <img src="./images/background.png" alt="background-image" />
  </div>
  <!-- 热点 -->
  <div class="hotLinks"></div>
  <script>
    (function() { 
      var hasRectSelect = false, hasMoving = false, hasResize = false, selRect, op = {}, startX, startY, _x, _y;
      var content = document.querySelector('.content');
      var hot = document.querySelector('.hotLinks');
      
      // 获取坐标和长宽信息
      var getPointInfo = function(s) {
        return {
          x: parseInt(s.left),
          y: parseInt(s.top),
          w: parseInt(s.width),
          h: parseInt(s.height)
        };
      };
      
      // 缓存坐标和长宽信息
      var cachePointInfo = function(ele, o) {
        ele.setAttribute('data-px', o.x);
        ele.setAttribute('data-py', o.y);
        ele.setAttribute('data-pw', o.w);
        ele.setAttribute('data-ph', o.h);
      };

      var renderRect = function(o) {
        var link = document.createElement('a');
        var span = document.createElement('span');
        span.className = 'resize';
        link.style.cssText = `width: ${o.w}px;height: ${o.h}px;left: ${o.x}px; top: ${o.y}px;`;
        link.className = "linkRect";
        link.text = '';
        link.appendChild(span);
        link.setAttribute('data-href', 'https://www.google.com/' + document.querySelectorAll('.linkRect').length);
        cachePointInfo(link, o);
        hot.appendChild(link);
      };

      document.querySelector('.content img').onload = function(){
        content.style.height = this.height + 'px';
        hot.style.height = this.height + 'px';
        content.removeChild(this);
      };

      content.onmousedown = function(e) { 
        hasRectSelect = true;
        startX = e.pageX;
        startY = e.pageY;
        e.stopPropagation(); 
      };

      document.onmousemove = function(e) { 
        if (hasRectSelect || hasMoving || hasResize) {
          _x = e.pageX;
          _y = e.pageY;
        }
        if (hasMoving || hasResize) {
          var mx = _x - startX;   // x轴移动距离
          var my = _y - startY;   // y轴移动距离
        }
        if (hasRectSelect) {  // 画框选框
          var w = Math.abs(_x - startX);  // x轴移动距离的绝对值
          var h = Math.abs(_y - startY);  // y轴移动距离的绝对值
          if (w < 3 || h < 3) return;   // 优化性能，避免鼠标误点
          
          if (!selRect) {
            selRect = document.createElement("div"); 
            selRect.style.cssText = "position:absolute;width:0px;height:0px;font-size:0px;margin:0px;padding:0px;border:1px dashed #0099FF;background-color:#C3D5ED;z-index:1000;filter:alpha(opacity:60);opacity:0.6;";  
            document.body.appendChild(selRect);
          }

          selRect.style.left = Math.min(_x, startX) + "px";
          selRect.style.top = Math.min(_y, startY) + "px";
          selRect.style.width = w + "px";
          selRect.style.height = h + "px"; 
        } else if (hasMoving) {  // 任意移动框选框
          hasMoving.style.left = op.x + mx + "px";
          hasMoving.style.top = op.y + my + "px";
        } else if (hasResize) {  // 缩放框选框
          hasResize.style.width = op.w + mx + "px";
          hasResize.style.height = op.h + my + "px";
        }
        e.stopPropagation(); 
      };

      hot.onmousedown = function(e){
        // 区分缩放和移动框选框
        if (e.target.className === 'resize')
          hasResize = e.target.parentElement;
        else
          hasMoving = e.target;
        startX = e.pageX;
        startY = e.pageY;
        op.x = parseInt(hasMoving ? hasMoving.style.left : hasResize.style.left);
        op.y = parseInt(hasMoving ? hasMoving.style.top : hasResize.style.top);
        op.w = parseInt(hasMoving ? hasMoving.style.width : hasResize.style.width);
        op.h = parseInt(hasMoving ? hasMoving.style.height : hasResize.style.height);
        e.stopPropagation();
      };

      document.onmouseup = function(e) { 
        if (selRect && hasRectSelect) { 
          var s = selRect.style;
          var info = getPointInfo(s);
          renderRect(info);
          document.body.removeChild(selRect);
        } else if (hasMoving || hasResize) {
          var ele = hasMoving || hasResize;
          var o = getPointInfo(ele.style);
          cachePointInfo(ele, o);
        } 
        hasRectSelect = false;
        hasMoving = false;
        hasResize = false;
        _x = null, _y = null, selRect = null, startX = null, startY = null, op = {};
      };
   })(); 
  </script>
</body>
</html>