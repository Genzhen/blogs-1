## 图片的处理过程

- 加载图片

  加载图片二进制格式到内存中并缓存，此时消耗了 100KB 内存 和 100KB 缓存。

- 解码图片

  将二进制格式解码为像素格式，此时占用宽 _ 高 _ 24（透明为 32 位）比特大小的内存,即 300 _ 500 _ 32，约等于 585 KB，这里约定名为像素格式内存。

- 渲染图片

  通过 CPU 或 GPU 渲染图片，若为 GPU 渲染，则还需上传到 GPU 显存，该过程较为耗时，由图片尺寸 / 显存位宽决定，图片尺寸越大，上传时间越慢，占用显存越多。

## 浏览器渲染图片

浏览器渲染图片的内存占用大小只跟图片的长宽有关，跟图片文件的大小并没有关系。

- 为何呢？

  浏览器会将页面中所有被渲染过的图片存在 Cache 中，占用浏览器进程的内存。以求页面浏览顺畅。

- 带来什么后果？

  如果页面图片过多过大，会导致浏览器内存耗尽而崩溃。

- 解决方案

  - 适度降低图片清晰度和质量，以缩小图片大小，减少图片数量，使用 svg,canvas，iconfont,css3 替代图片

  - 预加载图片，记住及时释放图片内存，变量赋值为 null

  - 将离屏 img 对象赋为 null，src 赋为 null，督促浏览器及时回收内存及像素格式内存

  - 将非可视区域图片移除，需要时再次渲染。和按需渲染结合时实现很简单，切换 src 与 v-src 即可。

### 图片加载优化

- 降低图片尺寸 -> 渐进式图片加载(progressive-image)

  - Compressor.io，支持 JPG、PNG、SVG、GIF，每次上传 1 个文件
  - Squoosh，支持 JPG、PNG、SVG、GIF，每次上传 1 个文件
  - Optimizilla，支持 JPG、PNG，最多每次上传 20 个文件
  - TinyPNG，支持 JPG、PNG，最多每次上传 20 个文件
  - SVGMinify，支持 SVG，每次上传 1 个文件
  - svgomg，支持 SVG，每次上传 1 个文件

- 按需加载图片

  lazyload

- 响应式加载图片

- CDN

- webp
